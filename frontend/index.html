<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeoGov Lite - Compliance Analysis Platform</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <i class="fas fa-shield-alt"></i>
                <span class="brand-text">GeoGov Lite</span>
                <span class="version-badge">v0.1.0</span>
            </div>
            <div class="nav-actions">
                <button class="btn btn-ghost" onclick="showSystemHealth()">
                    <i class="fas fa-heartbeat"></i>
                    System Health
                </button>
                <button class="btn btn-ghost" onclick="showSettings()">
                    <i class="fas fa-cog"></i>
                    Settings
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="main-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-section">
                <h3>Analysis Tools</h3>
                <ul class="nav-menu">
                    <li>
                        <a href="#" class="nav-item active" data-view="single-analysis">
                            <i class="fas fa-search"></i>
                            Single Analysis
                        </a>
                    </li>
                    <li>
                        <a href="#" class="nav-item" data-view="bulk-analysis">
                            <i class="fas fa-layer-group"></i>
                            Bulk Analysis
                        </a>
                    </li>
                    <li>
                        <a href="#" class="nav-item" data-view="results">
                            <i class="fas fa-chart-bar"></i>
                            Results Dashboard
                        </a>
                    </li>
                </ul>
            </div>
            
            <div class="sidebar-section">
                <h3>Data Management</h3>
                <ul class="nav-menu">
                    <li>
                        <a href="#" class="nav-item" data-view="corpus">
                            <i class="fas fa-database"></i>
                            Knowledge Base
                        </a>
                    </li>
                    <li>
                        <a href="#" class="nav-item" data-view="evidence">
                            <i class="fas fa-file-archive"></i>
                            Evidence Export
                        </a>
                    </li>
                    <li>
                        <a href="#" class="nav-item" data-view="audit">
                            <i class="fas fa-clipboard-list"></i>
                            Audit Trail
                        </a>
                    </li>
                </ul>
            </div>

            <div class="sidebar-footer">
                <div class="system-status" id="system-status">
                    <div class="status-indicator"></div>
                    <span>Checking status...</span>
                </div>
            </div>
        </aside>

        <!-- Content Area -->
        <main class="content">
            <!-- Single Analysis View -->
            <div id="single-analysis" class="view active">
                <div class="view-header">
                    <h1>Feature Compliance Analysis</h1>
                    <p>Analyze individual software features for geographical regulatory compliance requirements</p>
                </div>

                <div class="analysis-form">
                    <div class="form-section">
                        <h2>Feature Information</h2>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="feature_id">Feature ID *</label>
                                <input type="text" id="feature_id" name="feature_id" placeholder="e.g., F-2381" required>
                            </div>
                            <div class="form-group">
                                <label for="title">Feature Title *</label>
                                <input type="text" id="title" name="title" placeholder="e.g., Personalized Home Feed v3" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="description">Description *</label>
                            <textarea id="description" name="description" rows="4" 
                                placeholder="Detailed description of the feature, its functionality, and target markets..." required></textarea>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="docs">Documentation URLs</label>
                                <input type="text" id="docs" name="docs" 
                                    placeholder="https://internal/prd, https://internal/trd">
                                <small>Comma-separated list of relevant documentation URLs</small>
                            </div>
                            <div class="form-group">
                                <label for="tags">Feature Tags</label>
                                <input type="text" id="tags" name="tags" 
                                    placeholder="recommender, personalization, minors_possible">
                                <small>Comma-separated tags that describe the feature</small>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="code_hints">Code Hints</label>
                            <input type="text" id="code_hints" name="code_hints" 
                                placeholder="uses ageGate(), if region in ['EU','EEA']:">
                            <small>Code patterns or function calls that indicate compliance logic</small>
                        </div>
                    </div>

                    <div class="form-section">
                        <h2>Analysis Options</h2>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="use_rules_engine">
                                    <span class="checkmark"></span>
                                    Use Rules Engine (deterministic)
                                </label>
                                <small>Use rule-based decision making instead of LLM analysis</small>
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="detailed_analysis">
                                    <span class="checkmark"></span>
                                    Detailed Analysis
                                </label>
                                <small>Include detailed reasoning and counter-arguments</small>
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="loadExampleFeature()">
                            <i class="fas fa-lightbulb"></i>
                            Load Example
                        </button>
                        <button type="button" class="btn btn-primary" onclick="analyzeFeature()" id="analyze-btn">
                            <i class="fas fa-search"></i>
                            Analyze Feature
                        </button>
                    </div>
                </div>

                <!-- Results Section -->
                <div id="analysis-results" class="results-section" style="display: none;">
                    <h2>Analysis Results</h2>
                    <div id="results-content"></div>
                </div>
            </div>

            <!-- Bulk Analysis View -->
            <div id="bulk-analysis" class="view">
                <div class="view-header">
                    <h1>Bulk Feature Analysis</h1>
                    <p>Process multiple features simultaneously and export results</p>
                </div>

                <div class="bulk-options">
                    <div class="upload-section">
                        <h3>Input Method</h3>
                        <div class="input-methods">
                            <label class="radio-card">
                                <input type="radio" name="input-method" value="json" checked>
                                <div class="card-content">
                                    <i class="fas fa-code"></i>
                                    <span>JSON Input</span>
                                </div>
                            </label>
                            <label class="radio-card">
                                <input type="radio" name="input-method" value="csv">
                                <div class="card-content">
                                    <i class="fas fa-table"></i>
                                    <span>CSV Upload</span>
                                </div>
                            </label>
                            <label class="radio-card">
                                <input type="radio" name="input-method" value="template">
                                <div class="card-content">
                                    <i class="fas fa-file-alt"></i>
                                    <span>Use Template</span>
                                </div>
                            </label>
                        </div>
                    </div>

                    <div class="input-area">
                        <div class="json-input active">
                            <label for="bulk_features">Feature Data (JSON Array)</label>
                            <textarea id="bulk_features" rows="15" 
                                placeholder='[{"feature_id": "F-001", "title": "Feature 1", "description": "...", "tags": ["tag1"], "code_hints": ["hint1"], "docs": ["url1"]}]'></textarea>
                            <div class="input-actions">
                                <button class="btn btn-ghost" onclick="loadBulkTemplate()">Load Template</button>
                                <button class="btn btn-ghost" onclick="validateJSON()">Validate JSON</button>
                            </div>
                        </div>

                        <div class="csv-input">
                            <div class="file-upload">
                                <input type="file" id="csv-file" accept=".csv" style="display: none;">
                                <label for="csv-file" class="upload-label">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <span>Click to upload CSV file</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="bulk-actions">
                        <button class="btn btn-secondary" onclick="previewBulkAnalysis()">
                            <i class="fas fa-eye"></i>
                            Preview Analysis
                        </button>
                        <button class="btn btn-primary" onclick="runBulkAnalysis()" id="bulk-analyze-btn">
                            <i class="fas fa-play"></i>
                            Run Bulk Analysis
                        </button>
                    </div>
                </div>

                <div id="bulk-progress" class="progress-section" style="display: none;">
                    <h3>Analysis Progress</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                    <div class="progress-stats">
                        <span id="progress-text">Initializing...</span>
                        <span id="progress-percentage">0%</span>
                    </div>
                </div>

                <div id="bulk-results" class="results-section" style="display: none;">
                    <h3>Bulk Analysis Results</h3>
                    <div id="bulk-results-content"></div>
                </div>
            </div>

            <!-- Results Dashboard View -->
            <div id="results" class="view">
                <div class="view-header">
                    <h1>Results Dashboard</h1>
                    <p>Overview of compliance analysis results and trends</p>
                </div>

                <div class="dashboard-grid">
                    <div class="metric-card">
                        <div class="metric-header">
                            <i class="fas fa-search"></i>
                            <span>Total Analyses</span>
                        </div>
                        <div class="metric-value" id="total-analyses">-</div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-header">
                            <i class="fas fa-exclamation-triangle"></i>
                            <span>Compliance Required</span>
                        </div>
                        <div class="metric-value" id="compliance-required">-</div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-header">
                            <i class="fas fa-check-circle"></i>
                            <span>No Compliance</span>
                        </div>
                        <div class="metric-value" id="no-compliance">-</div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-header">
                            <i class="fas fa-percentage"></i>
                            <span>Avg. Confidence</span>
                        </div>
                        <div class="metric-value" id="avg-confidence">-</div>
                    </div>
                </div>

                <div class="dashboard-content">
                    <div class="chart-section">
                        <h3>Compliance by Regulation</h3>
                        <div class="chart-placeholder" id="regulation-chart">
                            <p>Analysis data will appear here after running compliance checks</p>
                        </div>
                    </div>

                    <div class="recent-results">
                        <h3>Recent Analyses</h3>
                        <div class="results-table" id="recent-results-table">
                            <p>No recent analyses found</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Knowledge Base View -->
            <div id="corpus" class="view">
                <div class="view-header">
                    <h1>Knowledge Base Management</h1>
                    <p>Manage regulatory documents and legal corpus</p>
                </div>

                <div class="corpus-stats">
                    <div class="stat-item">
                        <span class="stat-label">Documents Indexed</span>
                        <span class="stat-value" id="docs-indexed">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Vector Store Status</span>
                        <span class="stat-value" id="vector-status">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Last Updated</span>
                        <span class="stat-value" id="last-updated">-</span>
                    </div>
                </div>

                <div class="corpus-actions">
                    <button class="btn btn-primary" onclick="refreshCorpus()">
                        <i class="fas fa-sync-alt"></i>
                        Refresh Knowledge Base
                    </button>
                    <button class="btn btn-secondary" onclick="checkCorpusStatus()">
                        <i class="fas fa-info-circle"></i>
                        Check Status
                    </button>
                </div>

                <div id="corpus-status" class="status-section"></div>
            </div>

            <!-- Evidence Export View -->
            <div id="evidence" class="view">
                <div class="view-header">
                    <h1>Evidence Export</h1>
                    <p>Download audit trails and compliance evidence</p>
                </div>

                <div class="export-options">
                    <div class="export-card">
                        <div class="card-header">
                            <i class="fas fa-file-archive"></i>
                            <h3>Complete Evidence Package</h3>
                        </div>
                        <p>Download a ZIP file containing all receipts, analysis outputs, policy snapshots, and merkle trees</p>
                        <button class="btn btn-primary" onclick="downloadEvidence()">
                            <i class="fas fa-download"></i>
                            Download Evidence ZIP
                        </button>
                    </div>

                    <div class="export-card">
                        <div class="card-header">
                            <i class="fas fa-table"></i>
                            <h3>Analysis Results (CSV)</h3>
                        </div>
                        <p>Export analysis results in CSV format for further processing</p>
                        <button class="btn btn-secondary" onclick="downloadCSV()">
                            <i class="fas fa-file-csv"></i>
                            Download CSV
                        </button>
                    </div>

                    <div class="export-card">
                        <div class="card-header">
                            <i class="fas fa-shield-alt"></i>
                            <h3>Audit Trail</h3>
                        </div>
                        <p>Download JSONL audit trail with cryptographic receipts</p>
                        <button class="btn btn-secondary" onclick="downloadAuditTrail()">
                            <i class="fas fa-file-code"></i>
                            Download Receipts
                        </button>
                    </div>
                </div>
            </div>

            <!-- Audit Trail View -->
            <div id="audit" class="view">
                <div class="view-header">
                    <h1>Audit Trail</h1>
                    <p>Cryptographic audit trail of all compliance decisions</p>
                </div>

                <div class="audit-content">
                    <div class="audit-stats">
                        <div class="audit-stat">
                            <span class="label">Total Receipts</span>
                            <span class="value" id="total-receipts">-</span>
                        </div>
                        <div class="audit-stat">
                            <span class="label">Merkle Root</span>
                            <span class="value" id="merkle-root">-</span>
                        </div>
                        <div class="audit-stat">
                            <span class="label">Policy Version</span>
                            <span class="value" id="policy-version">-</span>
                        </div>
                    </div>

                    <div class="audit-trail-table" id="audit-trail">
                        <p>Loading audit trail...</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <div id="system-health-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>System Health Status</h2>
                <button class="modal-close" onclick="closeModal('system-health-modal')">&times;</button>
            </div>
            <div class="modal-body" id="health-modal-content">
                <p>Loading system status...</p>
            </div>
        </div>
    </div>

    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Settings</h2>
                <button class="modal-close" onclick="closeModal('settings-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <h3>API Configuration</h3>
                    <div class="form-group">
                        <label for="api-base-url">API Base URL</label>
                        <input type="text" id="api-base-url" value="http://localhost:8000/api">
                    </div>
                </div>
                <div class="settings-section">
                    <h3>Analysis Settings</h3>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="auto-refresh">
                            <span class="checkmark"></span>
                            Auto-refresh results
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('settings-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-spinner">
            <i class="fas fa-spinner fa-spin"></i>
            <p id="loading-text">Processing...</p>
        </div>
    </div>

    <!-- Notification System -->
    <div id="notifications" class="notifications-container"></div>

    <script src="app.js"></script>
</body>
</html>